# QQ Bot 独立部署配置
# 使用方法: docker-compose -f examples/qqbot/docker-compose.qqbot.yaml up -d

version: "3.8"

services:
  qqbot:
    build:
      context: ../..
      dockerfile: examples/qqbot/Dockerfile
    container_name: memoryos-qqbot
    restart: unless-stopped
    environment:
      # NapCat/go-cqhttp WebSocket 地址
      # host.docker.internal 指向宿主机（Windows/Mac）
      # Linux 需要使用 --add-host=host.docker.internal:host-gateway
      - CQHTTP_WS_URL=ws://host.docker.internal:6700
      
      # 数据库配置（覆盖 config.yaml）
      - DB_HOST=postgres
      - DB_PORT=5432
      - REDIS_HOST=redis
      
      # LLM 配置（可选覆盖）
      # - LLM_API_KEY=your-api-key
      # - LLM_BASE_URL=https://api.example.com/v1
    volumes:
      # 挂载配置文件（可选）
      - ../../config/config.yaml:/app/config/config.yaml:ro
    networks:
      - memoryos-network
    depends_on:
      - postgres
      - redis

  # 如果需要独立运行，取消下面的注释
  # postgres:
  #   image: pgvector/pgvector:pg16
  #   container_name: memoryos-postgres
  #   environment:
  #     POSTGRES_USER: memoryos
  #     POSTGRES_PASSWORD: memoryos123
  #     POSTGRES_DB: memoryos
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   networks:
  #     - memoryos-network

  # redis:
  #   image: redis:alpine
  #   container_name: memoryos-redis
  #   networks:
  #     - memoryos-network

networks:
  memoryos-network:
    external: true

# volumes:
#   postgres_data:

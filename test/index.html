<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemoryOS API æµ‹è¯•é¢æ¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { opacity: 0.9; }
        .content { padding: 30px; }
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 500;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:active { transform: translateY(0); }
        .output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.online { background: #4ade80; color: white; }
        .status.offline { background: #f87171; color: white; }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #4b5563;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  MemoryOS</h1>
            <p>Chatbot Intent Memory System - API æµ‹è¯•é¢æ¿</p>
            <span class="status online" id="status">â— è¿æ¥ä¸­...</span>
        </header>

        <div class="content">
            <!-- å¥åº·æ£€æŸ¥ -->
            <div class="section">
                <h2>ğŸ¥ ç³»ç»ŸçŠ¶æ€</h2>
                <div class="button-group">
                    <button onclick="checkHealth()">æ£€æŸ¥å¥åº·çŠ¶æ€</button>
                </div>
                <div class="output" id="healthOutput"></div>
            </div>

            <!-- åˆ›å»ºè®°å¿† -->
            <div class="section">
                <h2>â• åˆ›å»ºè®°å¿†</h2>
                <label>ç”¨æˆ· ID:</label>
                <input type="text" id="userId" value="user_alice" placeholder="ç”¨æˆ· ID">
                
                <label>æ¶ˆæ¯å†…å®¹:</label>
                <textarea id="messageContent" rows="3" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹">æˆ‘æƒ³å­¦ä¹  Go çš„å¹¶å‘ç¼–ç¨‹</textarea>
                
                <div class="button-group">
                    <button onclick="createDialogue('user')">åˆ›å»ºç”¨æˆ·æ¶ˆæ¯</button>
                    <button onclick="createDialogue('assistant')">åˆ›å»ºåŠ©æ‰‹å›å¤</button>
                    <button onclick="createProfile()">åˆ›å»ºç”¨æˆ·ç”»åƒ</button>
                </div>
                <div class="output" id="createOutput"></div>
            </div>

            <!-- å¬å›æ¥å£ -->
            <div class="section">
                <h2>ğŸ” å¬å›æµ‹è¯•</h2>
                <label>æŸ¥è¯¢å†…å®¹:</label>
                <input type="text" id="queryContent" value="Go å¹¶å‘ç¼–ç¨‹" placeholder="æŸ¥è¯¢å†…å®¹">
                
                <div class="button-group">
                    <button onclick="searchMemory()">æœç´¢è®°å¿†</button>
                    <button onclick="recallDialogue()">å¬å›å¯¹è¯ä¸Šä¸‹æ–‡</button>
                    <button onclick="recallProfile()">å¬å›ç”¨æˆ·ç”»åƒ</button>
                    <button onclick="hybridRecall()">æ··åˆå¬å›ï¼ˆè‡ªé€‚åº”ï¼‰</button>
                </div>
                <div class="output" id="recallOutput"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        let turnNumber = 1;

        async function callAPI(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (body) options.body = JSON.stringify(body);

                const response = await fetch(API_BASE + endpoint, options);
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function checkHealth() {
            const output = document.getElementById('healthOutput');
            output.innerHTML = '<span class="info">æ£€æŸ¥ä¸­...</span>';
            
            const result = await callAPI('/health');
            if (result.success) {
                const status = document.getElementById('status');
                status.className = 'status online';
                status.textContent = 'â— åœ¨çº¿';
                
                output.innerHTML = '<span class="success">âœ“ æœåŠ¡æ­£å¸¸è¿è¡Œ</span>\n' +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— è¿æ¥å¤±è´¥: ' + result.error + '</span>';
            }
        }

        async function createDialogue(role) {
            const userId = document.getElementById('userId').value;
            const content = document.getElementById('messageContent').value;
            const output = document.getElementById('createOutput');
            
            const memory = {
                user_id: userId,
                layer: "dialogue",
                type: role === 'user' ? "user_message" : "assistant_message",
                content: content,
                metadata: {
                    session_id: "session_001",
                    turn_number: turnNumber++,
                    role: role
                }
            };

            output.innerHTML = '<span class="info">åˆ›å»ºä¸­...</span>';
            const result = await callAPI('/api/v1/memories', 'POST', memory);
            
            if (result.success) {
                output.innerHTML = '<span class="success">âœ“ åˆ›å»ºæˆåŠŸ</span>\n' +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— åˆ›å»ºå¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        async function createProfile() {
            const userId = document.getElementById('userId').value;
            const output = document.getElementById('createOutput');
            
            const profile = {
                user_id: userId,
                layer: "profile",
                type: "user_identity",
                content: "Alice æ˜¯ä¸€ååç«¯å·¥ç¨‹å¸ˆï¼Œä¸»è¦ä½¿ç”¨ Pythonï¼Œæ­£åœ¨å­¦ä¹  Go è¯­è¨€",
                metadata: {
                    category: "identity",
                    tags: ["åç«¯å·¥ç¨‹å¸ˆ", "Python", "Goå­¦ä¹ è€…"],
                    confidence_level: 0.9,
                    is_pinned: true
                }
            };

            output.innerHTML = '<span class="info">åˆ›å»ºç”»åƒä¸­...</span>';
            const result = await callAPI('/api/v1/memories', 'POST', profile);
            
            if (result.success) {
                output.innerHTML = '<span class="success">âœ“ ç”»åƒåˆ›å»ºæˆåŠŸ</span>\n' +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— åˆ›å»ºå¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        async function searchMemory() {
            const userId = document.getElementById('userId').value;
            const query = document.getElementById('queryContent').value;
            const output = document.getElementById('recallOutput');
            
            output.innerHTML = '<span class="info">æœç´¢ä¸­...</span>';
            const result = await callAPI('/api/v1/memories/search', 'POST', {
                user_id: userId,
                query: query,
                top_k: 5
            });
            
            if (result.success) {
                output.innerHTML = `<span class="success">âœ“ æ‰¾åˆ° ${result.data.count} æ¡è®°å¿†</span>\n` +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— æœç´¢å¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        async function recallDialogue() {
            const userId = document.getElementById('userId').value;
            const output = document.getElementById('recallOutput');
            
            output.innerHTML = '<span class="info">å¬å›å¯¹è¯ä¸­...</span>';
            const result = await callAPI('/api/v1/recall/dialogue', 'POST', {
                user_id: userId,
                session_id: "session_001",
                recent_turns: 10
            });
            
            if (result.success) {
                output.innerHTML = `<span class="success">âœ“ å¬å› ${result.data.count} è½®å¯¹è¯</span>\n` +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— å¬å›å¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        async function recallProfile() {
            const userId = document.getElementById('userId').value;
            const output = document.getElementById('recallOutput');
            
            output.innerHTML = '<span class="info">åŠ è½½ç”»åƒä¸­...</span>';
            const result = await callAPI('/api/v1/recall/profile', 'POST', {
                user_id: userId
            });
            
            if (result.success) {
                output.innerHTML = `<span class="success">âœ“ åŠ è½½ ${result.data.count} æ¡ç”»åƒ</span>\n` +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— åŠ è½½å¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        async function hybridRecall() {
            const userId = document.getElementById('userId').value;
            const query = document.getElementById('queryContent').value;
            const output = document.getElementById('recallOutput');
            
            output.innerHTML = '<span class="info">æ··åˆå¬å›ä¸­...</span>';
            const result = await callAPI('/api/v1/recall/hybrid', 'POST', {
                user_id: userId,
                session_id: "session_001",
                query: query,
                dialog_stage: "multi_turn",
                max_tokens: 4000
            });
            
            if (result.success) {
                output.innerHTML = '<span class="success">âœ“ æ··åˆå¬å›æˆåŠŸ</span>\n' +
                    `å¯¹è¯: ${result.data.dialogue_count} | è¯é¢˜: ${result.data.topic_count} | ç”»åƒ: ${result.data.profile_count}\n` +
                    `ç­–ç•¥: ${result.data.strategy} | Token: ${result.data.tokens_used}\n\n` +
                    JSON.stringify(result.data, null, 2);
            } else {
                output.innerHTML = '<span class="error">âœ— å¬å›å¤±è´¥</span>\n' +
                    JSON.stringify(result.error || result.data, null, 2);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å¥åº·çŠ¶æ€
        window.onload = () => {
            setTimeout(checkHealth, 500);
        };
    </script>
</body>
</html>
